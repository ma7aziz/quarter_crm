{% load static %}
<div class="row">
    <div class="col">
        <div class="card">
            <div class="card-body bg-soft-info text-center">


                <h4 class="mb-1 mt-1"><span data-plugin="counterup">{{ today|length }}</span></h4>
                <p class="text-muted mb-0">عدد المهام اليوم </p>


            </div>
        </div>
    </div> <!-- end col-->
    <div class="col">
        <div class="card">
            <div class="card-body bg-soft-success text-center">

                <h4 class="mb-1 mt-1"><span data-plugin="counterup">{{  history| length }}</span></h4>
                <p class="text-muted mb-0"> جميع المهام </p>
            </div>
        </div>
    </div> <!-- end col-->


</div>

<div class="card border border-success">
    <div class="card-body">
        <h2 class=" mb-4" dir="rtl">المهام الجديدة </h2>
        <div class="table-responsive" data-simplebar style="max-height: 430px;">
            <table class="table table-centered table-nowrap mb-0" dir="rtl">
                <thead class="table-light">
                    <tr>

                        <th class="d-none d-lg-table-cell ">رقم الطلب </th>
                        <th class="">أسم العميل</th>
                        <th>التاريخ</th>
                        <th class="d-none d-lg-table-cell ">نوع الطلب </th>
                        <th>التفاصيل</th>
                    </tr>
                </thead>
                <tbody>
                    {% for req in requests %}
                    <tr {% if req.is_past_due %} class="bg-soft-danger" {% endif %}>

                        <td class="d-none d-lg-table-cell"><a
                                href="{% url 'service_request_details' req.service_request.id %}"
                                class="text-body fw-bold ">#{{req.service_request.request_number}}</a>
                        </td>
                        <td>{{req.service_request.customer_name|truncatechars:20}}</td>
                        <td>
                            {% if req.is_today %}
                            <div class="badge bg-soft-success p-1" style="font-size: 16px;">اليوم </div>

                            {% else%}
                            {{req.date}}
                            {% endif %}
                        </td>

                        <td class="d-none d-lg-table-cell ">
                            {{req.service_request.get_service_type_display}}
                        </td>

                        <td>
                            <a class="btn btn-primary btn-sm btn-rounded waves-effect waves-light"
                                href="{% url 'service_request_details' req.service_request.id  %}">
                                التفاصيل
                            </a>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
        <!-- end table-responsive -->
    </div>
</div>

<div class="card border border-info">
    <div class="card-body">
        <h2 class=" mb-4" dir="rtl">المهام السابقة </h2>
        <div class="table-responsive" data-simplebar style="max-height: 430px;">
            <table class="table table-centered table-nowrap mb-0" dir="rtl">
                <thead class="table-light">
                    <tr>
                        <th>رقم الطلب </th>
                        <th>أسم العميل</th>
                        <th class="d-none d-lg-table-cell ">التاريخ</th>
                        <th class="d-none d-lg-table-cell ">الموقع</th>
                        <th>حالة الطلب </th>
                        <th class="d-none d-lg-table-cell ">التفاصيل</th>
                    </tr>
                </thead>
                <tbody>
                    {% for req in history %}
                    <tr>

                        <td><a href="{% url 'service_request_details' req.service_request.id %}"
                                class="text-body fw-bold">#{{req.service_request.request_number}}</a> </td>
                        <td> <a href="{% url 'service_request_details' req.service_request.id %}">
                                {{req.service_request.customer_name|truncatechars:20}}</a></td>
                        <td class="d-none d-lg-table-cell ">
                            {{req.date}}
                        </td>

                        <td class="d-none d-lg-table-cell ">
                            {{req.service_request.address}}
                        </td>
                        <td>

                            <span class="badge 
                                    {% if req.service_request.hold %}
                                    bg-danger
                                    {% else %}  
                                        {% if req.service_request.status == 'new' %}
                                        bg-info
                                        {% elif req.service_request.status == 'under_process' %}
                                        bg-warning
                                        {% elif req.service_request.status == 'done' %}
                                        bg-success 
                                        
                                        {% else %}
                                        bg-danger
                                        {% endif %}
                                    {% endif %}
                                         p-2 ">
                                {% if req.service_request.hold %}
                                معلق
                                {% else %}
                                {{req.service_request.get_status_display}}
                                {% endif %}
                            </span>

                        </td>
                        <td class="d-none d-lg-table-cell ">
                            <a class="btn btn-primary btn-sm btn-rounded waves-effect waves-light"
                                href="{% url 'service_request_details' req.service_request.id %}">
                                التفاصيل
                            </a>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
        <!-- end table-responsive -->
    </div>
</div>