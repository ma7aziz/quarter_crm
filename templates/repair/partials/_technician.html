{% if 'history' in request.path %}
<div class="row">
    <div class="col-lg-12">
        <div class="card">
            <div class="card-body">
                <h4 class="card-title mb-4" dir="rtl">المهام السابقة </h4>
                <div class="table-responsive">
                    <table class="table table-centered table-nowrap mb-0" dir="rtl">
                        <thead class="table-light">
                            <tr>

                                <th>رقم الطلب </th>
                                <th>أسم العميل</th>
                                <th>التاريخ</th>

                                <th>الموقع</th>
                                <th>حالة الطلب </th>
                                <th>التفاصيل</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for req in requests %}
                            <tr>

                                <td><a href="{% url 'service_request_details' req.id %}"
                                        class="text-body fw-bold">#{{req.service_request.request_number}}</a> </td>
                                <td>{{req.service_request.customer_name}}</td>
                                <td>
                                    {{req.date}}
                                </td>

                                <td>
                                    {{req.service_request.address}}
                                </td>
                                <td>
                                    {{req.get_status_display}}
                                </td>
                                <td>
                                    <a class="btn btn-primary btn-sm btn-rounded waves-effect waves-light"
                                        href="{% url 'appointment_details' req.id %}">
                                        التفاصيل
                                    </a>
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
                <!-- end table-responsive -->
            </div>
        </div>
        <div class="card">
            <div class="card-body">
                <h4 class="card-title mb-4" dir="rtl">مهام اخري سابقة </h4>
                <div class="table-responsive">
                    <table class="table table-centered table-striped table-nowrap mb-0" dir="rtl">
                        <thead class="table-dark">
                            <tr>

                                <!-- <th>اسم الموظف </th> -->
                                <th>المهمة </th>
                                <th>حالة الطلب </th>
                                <th>الوقت المحدد </th>

                                <th></th>

                            </tr>
                        </thead>

                        <tbody>
                            {% for task in other_tasks %}
                            <tr>
                                <!-- <td>
                                    {% if task.employee.name %}
                                    <a href="{% url 'profile' task.employee.username %}">{{task.employee.name}}</a>
                                    {% else %}
                                    <a href="{% url 'profile' task.employee.username %}">{{task.employee.username}}</a>
                                    {% endif %}

                                </td> -->
                                <td>
                                    {{task.title|truncatechars:20}}
                                </td>
                                <td>
                                    {% if task.status == "closed" %}
                                    <span class="badge bg-soft-success p-2">
                                        انتهت
                                        {% elif task.status  == "completed" %}
                                        <span class="badge bg-soft-info p-2">
                                            تمت المهمة
                                            {% endif %}
                                        </span>
                                </td>
                                <td>
                                    {{ task.due_date.date }}
                                </td>



                                <td>

                                    <button class=" btn btn-soft-primary btn-rounded waves-effect waves-light "
                                        data-bs-toggle="modal" data-bs-target="#taskmodal{{task.id}}">
                                        <i class="uil uil-pen "></i> التفاصيل
                                    </button>
                                </td>



                            </tr>
                            <div class="modal fade" id="taskmodal{{task.id}}" tabindex="-1" role="dialog"
                                aria-labelledby="exampleModalCenterTitle" aria-hidden="true">
                                <div class="modal-dialog modal-dialog-centered" role="document">
                                    <div class="modal-content">
                                        <div class="modal-header text-center">
                                            <h5 class="modal-title ">{{task.title}}</h5>
                                            <button type="button" class="btn-close" data-bs-dismiss="modal"
                                                aria-label="Close">
                                            </button>
                                        </div>
                                        <div class="modal-body">
                                            <div class="border-bottom">

                                                <p>تاريخ تعيين المهمة : {{task.timestamp.date}}</p>
                                                <p>بواسطة :
                                                    {%if task.created_by.name %}
                                                    <span style="font-size: 18px;">{{task.created_by.name}}</span>
                                                    {% else %}
                                                    {{task.created_by.user.name}}
                                                    {% endif %}
                                                </p>
                                            </div>
                                            <div class="border-bottom">
                                                <span>تفاصيل المهمة :</span>
                                                <p style="font-size: 18px;">{{task.details}}</p>
                                            </div>
                                            <div class=" border-bottom mt-2">
                                                <span>الوقت المحدد للتنفيذ :</span>
                                                <p>{{task.due_date.date}}</p>
                                            </div>
                                            {% if task.files %}
                                            <div class="  mt-2">
                                                <span></span>
                                                <a class="btn btn-lg bg-soft-primary" href="{{task.files.url}}"
                                                    target="_blank">عرض الملفات
                                                </a>
                                            </div>
                                            {% endif %}


                                        </div>
                                        <div class="modal-footer">
                                            <button type="button" class="btn btn-light"
                                                data-bs-dismiss="modal">اغلاق</button>

                                        </div>
                                    </div>
                                </div>
                            </div>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
                <!-- end table-responsive -->
            </div>
        </div>
    </div>
</div>
{% else %}
<div class="row">
    <div class="col-lg-12">
        <div class="card">
            <div class="card-body">
                <h4 class="card-title mb-4" dir="rtl">المهام الجديدة </h4>
                <div class="table-responsive">
                    <table class="table table-centered table-nowrap mb-0" dir="rtl">
                        <thead class="table-light">
                            <tr>

                                <th>رقم الطلب </th>
                                <th>أسم العميل</th>
                                <th>التاريخ</th>

                                <th>الموقع</th>

                                <th>التفاصيل</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for req in requests %}
                            <tr>

                                <td><a href="{% url 'service_request_details' req.id %}"
                                        class="text-body fw-bold">#{{req.service_request.request_number}}</a> </td>
                                <td>{{req.service_request.customer_name}}</td>
                                <td>
                                    {{req.date}}
                                </td>

                                <td>
                                    {{req.service_request.address}}
                                </td>

                                <td>
                                    <a class="btn btn-primary btn-sm btn-rounded waves-effect waves-light"
                                        href="{% url 'appointment_details' req.id %}">
                                        التفاصيل
                                    </a>
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
                <!-- end table-responsive -->
            </div>
        </div>
        <div class="card">
            <div class="card-body">
                <h4 class="card-title mb-4" dir="rtl">المهام الجديدة </h4>
                <div class="table-responsive">
                    <table class="table table-centered table-striped table-nowrap mb-0" dir="rtl">
                        <thead class="table-dark">
                            <tr>

                                <th>اسم الموظف </th>
                                <th>المهمة </th>
                                <th>حالة الطلب </th>
                                <th>الوقت المحدد </th>

                                <th></th>
                                <th></th>
                            </tr>
                        </thead>

                        <tbody>
                            {% for task in other_tasks %}
                            <tr>
                                <td>
                                    {% if task.employee.name %}
                                    <a href="{% url 'profile' task.employee.username %}">{{task.employee.name}}</a>
                                    {% else %}
                                    <a href="{% url 'profile' task.employee.username %}">{{task.employee.username}}</a>
                                    {% endif %}

                                </td>
                                <td>
                                    {{task.title|truncatechars:20}}
                                </td>
                                <td>
                                    {% if task.status == "open" %}
                                    <span class="badge bg-soft-danger p-2">
                                        جاري التنفيذ
                                        {% elif task.status  == "completed" %}
                                        <span class="badge bg-soft-success p-2">
                                            تمت المهمة
                                            {% endif %}
                                        </span>
                                </td>
                                <td>
                                    {{ task.due_date.date }}
                                </td>



                                <td>

                                    <button class=" btn btn-soft-primary btn-rounded waves-effect waves-light "
                                        data-bs-toggle="modal" data-bs-target="#taskmodal{{task.id}}">
                                        <i class="uil uil-pen "></i> التفاصيل
                                    </button>
                                </td>
                                <td>
                                    <form action="{% url 'update_task' %}" method="POST">
                                        {% csrf_token %}
                                        <input type="hidden" name="task_id" value="{{task.id}}">
                                        <button class="btn btn-rounded waves-effect waves-light bg-soft-success ">
                                            اتمام
                                            <i class="fas fa-check-circle"></i>
                                        </button>
                                    </form>
                                </td>


                            </tr>
                            <div class="modal fade" id="taskmodal{{task.id}}" tabindex="-1" role="dialog"
                                aria-labelledby="exampleModalCenterTitle" aria-hidden="true">
                                <div class="modal-dialog modal-dialog-centered" role="document">
                                    <div class="modal-content">
                                        <div class="modal-header text-center">
                                            <h5 class="modal-title ">{{task.title}}</h5>
                                            <button type="button" class="btn-close" data-bs-dismiss="modal"
                                                aria-label="Close">
                                            </button>
                                        </div>
                                        <div class="modal-body">
                                            <div class="border-bottom">

                                                <p>تاريخ تعيين المهمة : {{task.timestamp.date}}</p>
                                                <p>بواسطة :
                                                    {%if task.created_by.name %}
                                                    <span style="font-size: 18px;">{{task.created_by.name}}</span>
                                                    {% else %}
                                                    {{task.created_by.user.name}}
                                                    {% endif %}
                                                </p>
                                            </div>
                                            <div class="border-bottom">
                                                <span>تفاصيل المهمة :</span>
                                                <p style="font-size: 18px;">{{task.details}}</p>
                                            </div>
                                            <div class=" border-bottom mt-2">
                                                <span>الوقت المحدد للتنفيذ :</span>
                                                <p>{{task.due_date.date}}</p>
                                            </div>
                                            {% if task.files %}
                                            <div class="  mt-2">
                                                <span></span>
                                                <a class="btn btn-lg bg-soft-primary" href="{{task.files.url}}"
                                                    target="_blank">عرض الملفات
                                                </a>
                                            </div>
                                            {% endif %}


                                        </div>
                                        <div class="modal-footer">
                                            <button type="button" class="btn btn-light"
                                                data-bs-dismiss="modal">اغلاق</button>

                                        </div>
                                    </div>
                                </div>
                            </div>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
                <!-- end table-responsive -->
            </div>
        </div>
    </div>
</div>
{% endif %}